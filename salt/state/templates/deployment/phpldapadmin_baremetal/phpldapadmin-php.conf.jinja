<?php
/** NOTE **
 ** Make sure that <?php is the FIRST line of this file!
 ** IE: There should NOT be any blank lines or spaces BEFORE <?php
 **/

{%- if True or ('debug' in config and config.debug) %}
/* If you are asked to put PLA in debug mode, this is how you do it: */
$config->custom->debug['level'] = {{config.debug}};
$config->custom->debug['syslog'] = true;
$config->custom->debug['file'] = '/var/log/apache/phpldapadmin.log';
{%- endif %}

$config->custom->session['blowfish'] = 'b020c7a4135f94d4ac2843350b60e63e';  # Autogenerated for infra

$config->custom->appearance['timezone'] = '{{pillar.timezone}}';

$config->custom->appearance['friendly_attrs'] = array(
	'facsimileTelephoneNumber' => 'Fax',
	'gid'                      => 'Group',
	'mail'                     => 'Email',
	'telephoneNumber'          => 'Telephone',
	'uid'                      => 'User Name',
	'userPassword'             => 'Password'
);


$servers = new Datastore();

/* $servers->NewServer('ldap_pla') must be called before each new LDAP server
   declaration. */
{%- for server_name, server in config.servers.iteritems() %}
$servers->newServer('ldap_pla');
$servers->setValue('server','name','{{server_name}}');
{%-     for key_group_name, key_group_value in server.iteritems() %}
{%-         for key_name, key_value in key_group_value.iteritems() %}
{%-             if key_value == False or key_value == True %}
{%-                 set key_value = (key_value|string).lower() %}
{%-             elif key_value is string %}
{%-                 set key_value = "'" ~ key_value ~ "'" %}
{%-             elif key_value is iterable %}
{%-                 set quoted = [] %}
{%-                 for key_value_item in key_value %}
{%-                     do quoted.append("'"~key_value_item~"'") %}
{%-                 endfor %}
{%-                 set key_value = 'array(' ~ ','.join(quoted) ~ ')' %}
{%-             endif %}
$servers->setValue('{{key_group_name}}','{{key_name}}',{{key_value}});
{%-         endfor %}
{%-     endfor %}
{%- endfor %}
