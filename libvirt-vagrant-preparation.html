
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Libvirt / Vagrant Preparation &#8212; SoeStack 2.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Nexus quickstart" href="nexus-quickstart.html" />
    <link rel="prev" title="QUICKSTART" href="QUICKSTART.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="libvirt-vagrant-preparation">
<span id="vagrant-prep"></span><h1>Libvirt / Vagrant Preparation<a class="headerlink" href="#libvirt-vagrant-preparation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="installing-the-tools">
<h2>Installing the tools<a class="headerlink" href="#installing-the-tools" title="Permalink to this headline">¶</a></h2>
<p>You will need libvirt and vagrant installed. We will also install the vagrant-libvirt integration.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo yum -y install vagrant libvirtd virt-manager vagrant-libvirt</span>
</pre></div>
</div>
</div>
<div class="section" id="configuring-the-virtual-network-for-vagrant">
<h2>Configuring the virtual network for vagrant<a class="headerlink" href="#configuring-the-virtual-network-for-vagrant" title="Permalink to this headline">¶</a></h2>
<p>The demo files are designed to work with a subnet <code class="docutils literal notranslate"><span class="pre">192.168.121.x/24</span></code>.</p>
<p>The following file can be used to configure libvirt to provide this network, if you do not already have it.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;network</span> <span class="na">ipv6=</span><span class="s">&#39;yes&#39;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;name&gt;</span>vagrant-libvirt<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;forward</span> <span class="na">mode=</span><span class="s">&#39;nat&#39;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;bridge</span> <span class="na">stp=</span><span class="s">&#39;on&#39;</span> <span class="na">delay=</span><span class="s">&#39;0&#39;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;ip</span> <span class="na">address=</span><span class="s">&#39;192.168.121.1&#39;</span> <span class="na">netmask=</span><span class="s">&#39;255.255.255.0&#39;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;dhcp&gt;</span>
        <span class="nt">&lt;range</span> <span class="na">start=</span><span class="s">&#39;192.168.121.1&#39;</span> <span class="na">end=</span><span class="s">&#39;192.168.121.254&#39;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/dhcp&gt;</span>
    <span class="nt">&lt;/ip&gt;</span>
<span class="nt">&lt;/network&gt;</span>
</pre></div>
</div>
<p>Create this xml file somewhere then run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>&gt; virsh net-define /path/to/vagrant-libvirt-network.xml
</pre></div>
</div>
<p>Alternatively you can use an existing libvirt network, and search/replace 192.168.121 within the demo files.</p>
</div>
<div class="section" id="configuring-a-storage-pool">
<h2>Configuring a storage pool<a class="headerlink" href="#configuring-a-storage-pool" title="Permalink to this headline">¶</a></h2>
<p>The included <code class="docutils literal notranslate"><span class="pre">Vagrantfile</span></code> expects <code class="docutils literal notranslate"><span class="pre">libvirt</span></code> to be configured with a storage pool (for disk image files) called <code class="docutils literal notranslate"><span class="pre">linux</span></code>.</p>
<p>Either change this to match one of your existing storage pools in <code class="docutils literal notranslate"><span class="pre">provision/vagrant/Vagrantfile</span></code>, comment it out, or create a new storage pool.</p>
<p>Example commands for creating a storage pool are as follows:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">dir=/var/lib/libvirt/images/vagrant</span>

<span class="go">mkdir -p &quot;$dir&quot;</span>

<span class="go">chown qemu.qemu &quot;$dir&quot;</span>

<span class="gp">#</span> If you <span class="k">do</span> not use SELinux, you can skip the following chcon <span class="nb">command</span>
<span class="go">chcon -t virt_content_t &quot;$dir&quot;</span>

<span class="go">virsh pool-create-as vagrant dir --target &quot;$dir&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="configuring-a-user-account-to-allow-vagrant-usage">
<h2>Configuring a user account to allow vagrant usage<a class="headerlink" href="#configuring-a-user-account-to-allow-vagrant-usage" title="Permalink to this headline">¶</a></h2>
<p>In Fedora, this is done by adding the user to the <code class="docutils literal notranslate"><span class="pre">qemu</span></code> group:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>&gt; usermod -a -G qemu &lt;username&gt;
</pre></div>
</div>
<p>After adding the user to the group you may need to either log out entirely and then back in again, or else within an existing shell, use the following command to start a new shell with the new <code class="docutils literal notranslate"><span class="pre">qemu</span></code> group permissions activated:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>&gt; newgrp qemu
</pre></div>
</div>
</div>
<div class="section" id="configuring-a-vagrant-image-file">
<h2>Configuring a Vagrant image file<a class="headerlink" href="#configuring-a-vagrant-image-file" title="Permalink to this headline">¶</a></h2>
<p>While vagrant itself can download <code class="docutils literal notranslate"><span class="pre">box</span></code> files, it is often (especially in a disconnected network environment) or when intending to re-use the files, preferable to download a box file separately and manually <code class="docutils literal notranslate"><span class="pre">add</span></code> it for use with vagrant.</p>
<p>The demo <code class="docutils literal notranslate"><span class="pre">Vagrantfile</span></code> specifies an image file (<code class="docutils literal notranslate"><span class="pre">box</span></code> file) named <code class="docutils literal notranslate"><span class="pre">centos/7.1902.01</span></code>.</p>
<p>To have vagrant automatically download and install the image, replace <code class="docutils literal notranslate"><span class="pre">centos/7.1902.01</span></code> in <code class="docutils literal notranslate"><span class="pre">provision/vagrant/Vagrantfile</span></code> with <code class="docutils literal notranslate"><span class="pre">centos/7</span></code>.</p>
<p>To manually download the image file and install it, you can browse to <code class="docutils literal notranslate"><span class="pre">http://cloud.centos.org/centos/7/vagrant/x86_64/images/</span></code>, have a look at what image files are available, choose a version, then do as follows (this example uses the <code class="docutils literal notranslate"><span class="pre">CentOS-7-x86_64-Vagrant-1902_01.Libvirt.box</span></code> file and loads it with a name <code class="docutils literal notranslate"><span class="pre">centos/7.1902.01</span></code>):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>&gt; wget http://cloud.centos.org/centos/7/vagrant/x86_64/images/CentOS-7-x86_64-Vagrant-1902_01.Libvirt.box

<span class="gp">$</span>&gt; vagrant box add --name centos/7.1902.01 CentOS-7-x86_64-Vagrant-1902_01.Libvirt.box
</pre></div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">SoeStack</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="includeme.html">SoeStack - a SOE for Linux systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="LICENSE.html">LICENSE</a></li>
<li class="toctree-l1"><a class="reference internal" href="ABOUT.html">About SoeStack</a></li>
<li class="toctree-l1"><a class="reference internal" href="QUICKSTART.html">QUICKSTART</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Libvirt / Vagrant Preparation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installing-the-tools">Installing the tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuring-the-virtual-network-for-vagrant">Configuring the virtual network for vagrant</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuring-a-storage-pool">Configuring a storage pool</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuring-a-user-account-to-allow-vagrant-usage">Configuring a user account to allow vagrant usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuring-a-vagrant-image-file">Configuring a Vagrant image file</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="nexus-quickstart.html">Nexus quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="TODOS.html">TODO</a></li>
</ul>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="structure.html">SoeStack Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="before-generating-usb.html">Steps to do before generating USB stick</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="QUICKSTART.html" title="previous chapter">QUICKSTART</a></li>
      <li>Next: <a href="nexus-quickstart.html" title="next chapter">Nexus quickstart</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Chris Sincock.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/libvirt-vagrant-preparation.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>